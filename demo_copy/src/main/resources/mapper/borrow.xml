<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace : 해당 mapper를 사용하는 DAO 정보 입력 -->
<mapper namespace="com.example.demo.borrow.BorrowDAO">

    <resultMap type="com.example.demo.borrow.BorrowTblVO" id="borrowMap">
        <result property="brCode"     column="BRCODE" />
        <result property="isbn"       column="ISBN" />
        <result property="title"      column="TITLE" />
        <result property="userId"     column="USERID" />
        <result property="brDate"     column="BRDATE" />
        <result property="dueDate"    column="DUEDATE" />
        <result property="renew"      column="RENEW" />
    </resultMap>

    <select id="getBookCount" resultType="Integer">
        SELECT NVL(COUNT(*), 0) FROM BORROW_TBL WHERE USERID=#{userId}
    </select>

    <insert id="insertOneBorrow">
        INSERT INTO BORROW_TBL(BRCODE, ISBN, TITLE, USERID, BRDATE, DUEDATE, RENEW) VALUES
        (#{brCode}, #{isbn}, #{title}, #{userId}, SYSDATE, (SYSDATE + 10), #{renew})
    </insert>

    <select id="checkBorrowUser" resultMap="borrowMap">
        SELECT * FROM BORROW_TBL WHERE ISBN=#{isbn} AND USERID=#{userId}
    </select>

    <delete id="deleteOneBorrow">
        DELETE FROM BORROW_TBL WHERE ISBN=#{isbn} AND USERID=#{userId}
    </delete>

    <select id="selectBorrowData" resultType="Integer">
        SELECT NVL(COUNT(*), 0) FROM BORROW_TBL WHERE ISBN=#{isbn}
    </select>


    <update id="updateBrStatus">
        UPDATE BORROW_TBL SET  WHERE ISBN=#{isbn}
    </update>
    
    <select id="selectBorrowCount" resultType="Integer">
        SELECT NVL(COUNT(*), 0) FROM BORROW_TBL WHERE ISBN = #{isbn}
    </select>

   <select id="selectBrList" resultMap="borrowMap">
        SELECT * FROM BORROW_TBL WHERE USERID=#{userId}
    </select>

    <update id="updateRenew">
        UPDATE BORROW_TBL SET DUEDATE=(DUEDATE+10), RENEW=#{renew} WHERE ISBN=#{isbn} AND USERID=#{userId}
    </update>

    <select id="selectBorrowByRenew" resultMap="borrowMap">
        SELECT * FROM BORROW_TBL WHERE ISBN=#{isbn} AND USERID = #{userId}
    </select>
    
</mapper>